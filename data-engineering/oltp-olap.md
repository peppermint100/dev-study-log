# OLTP, OLAP

# 기본개념
## OLTP
OLTP는 온라인 거래 처리(Online Transaction Processing)의 약자로 실시간으로 발생하는 수많은 거래들을 Transaction 단위로 처리하고 기록한다. 여기서 Transaction은 데이터베이스의 상태를 변경시키는 하나의 작업 단위를 의미한다.

일반적으로 비즈니스 운영에서 발생하는 데이터를 빠르고 안정적으로 CRUD하며 데이터의 분석보다 데이터의 정확한 기록과 유지를 목표로 한다. 

실생활에서는 은행 ATM, 항공권, 기차표 예매 등 하나의 처리가 중요하고 여러 변경 상태를 포함하며 실시간으로 당장 처리가 필요한 경우에 사용되는 시스템이다. 

이러한 OLTP의 특징은 아래와 같다.

- 실시간으로 사용자의 요청을 즉시 처리한다.
- Transaction이라는 단위로 계좌 이체의 경우 두 계좌의 잔고 변환을 논리적으로 하나로 묶어서 진행한다.
- 데이터 생성, 삭제, 수정 작업이 대부분이다.
- ACID 원칙을 지킨다.

## OLAP
OLAP는 온라인 분석 처리(Online Analytical Processing)의 약자로 방대하게 축적된 데이터를 다각도로 분석하고 요약한다. 

일반적으로 비즈니스 의사결정을 위해 수집한 대용량의 데이터를 조회, 집계하며 데이터의 기록보다 대규모 데이터의 빠른 분석과 요약을 목표로 한다.

실생활에서는 분기별 매출 비교, 지역별 고객 행동 분석 등 여러 조건으로 데이터를 탐색하고 종합하여 비즈니스 전략을 세워야 하는 경우에 사용되는 시스템이다.

이러한 OLAP의 특징은 아래와 같다.

* 의사결정을 지원하기 위해 대규모 데이터를 분석하고 통찰력을 제공한다.
* 데이터를 다차원 구조로 보고 사용자가 여러 관점(시간, 지역 등)으로 직접 탐색하게 한다.
* 복잡한 조회(SELECT) 작업과 데이터 집계가 대부분이다.
* 과거부터 쌓인 대용량의 이력(Historical) 데이터를 주로 다룬다.

| 구분      | OLTP                            | OLAP                                 |
|---------|---------------------------------|--------------------------------------|
| 주요 목적   | 데이터의 안정적인 처리 및 저장               | 데이터 기반 통찰력 발견 및 분석                   |
| 쿼리 형태   | 빠르고 단순한 INSERT, UPDATE, DELETE  | 복잡하고 무거운 SELECT, GROUP BY            |
| 데이터 모델링 | 정규화 (Normalization)(데이터 중복 최소화) | 비정규화 (Denormalization)(빠른 조회를 위한 구조) |
| 주요 사용자  | 일반 사용자, 현업 실무자                  | 데이터 분석가, 경영진, 마케터                    |
| 다루는 데이터 | 실시간 최신 데이터                      | 과거부터 누적된 이력(Historical) 데이터          |
| 성능 척도   | 처리량 (Throughput)(초당 트랜잭션 수)     | 응답 속도 (Response Time)(쿼리 완료 시간)      |

# 아키텍쳐와 데이터 흐름

## 아키텍쳐
OLTP와 OLAP는 일반적으로 별개의 시스템으로 구축되어서 서로 데이터를 주고 받는다. 

예를 들어 어떤 사람이 쿠팡에서 특정 상품을 주문하면, 주문에 대한 정보, 배송 정보가 OLTP에 저장이 되고 이 정보를 바탕으로 OLAP에 데이터가 집계되어 이 유저가 구매한 금액, 이 유저가 구매한 상품 카테고리에 소비된 총 금액과 같이 비즈니스 분석에 활용될 수 있도록 저장된다.

즉 OLTP 시스템은 일반적으로 우리가 사용하는 웹, 앱의 메인 데이터베이스이며 사용자의 요청을 실시간으로 처리하고, 성능에 영향을 주지 않도록(성능 척도가 Throughput) 분석용 쿼리 실행은 최소로 한다.

OLAP는 분석을 위해 OLTP와 별도로 구성하는 대용량 데이터 저장소로 OLTP 시스템으로부터 데이터를 수집하고 분석에 용이한 형태로 가공하여 저장한다. 일반적으로 데이터 웨어하우스라고 부른다.

### 스타 스키마(Star Schema)
- 스타 스키마는 OLAP의 일반적인 형태로 데이터를 Facts, Dimensions로 나누어 저장하는 형태를 말한다.
- Facts는 실제 집계되는 데이터 값, Dimensions는 해당 데이터를 바라보는 차원을 의미한다.
- 예를 들어 물품 구매에 있어서 Dimensions는 물품의 카테고리, 색상이고 Facts는 구매 수량에 해당하는 정수 값이다.

### 눈송이 스키마(Snowflake Schema)
- 눈송이 스키마는 스타 스키마에서 조금 더 복잡한 형태로 스타스키마의 카테고리를 한 번 더 확장한다.
- Facts, Dimensions는 유지되고 물품 카테고리에 해당하는 생활용품에서 한 번 더 확장된 청소도구, 주방용품 등으로 나뉜다.
- 카테고리 정보는 별도의 매핑 테이블로 분리되어 효율적으로 저장된다.

-> 스타 스키마는 구조가 단순하고 데이터 중복이 많다, 눈송이 스키마는 구조가 복잡하지만 여러 카테고리를 나누어 저장공간 효율적으로 데이터를 저장할 수 있다. 다만 데이터 분석시 각 카테고리가 어느 카테고리 확장에 해당하는지 여러번 Join 해야하는 경우가 생길 수 있다.

## 데이터 흐름
OLAP에서 데이터를 분석하기 위한 데이터를 OLTP로부터 옮기는 과정을 ETL이라고 한다. Extract, Transform, Load의 약자로 추출, 변환, 적재이다. 

> 다만 OLTP의 데이터를 대용량으로 쿼리하는게 좋지 않을 수도 있어서 메시지큐를 사용하거나 ETL에 유리하도록 모델링을 하는 경우도 있다. 해당 내용을 이전 글 [데이터 파이프라인 가이드]에서 확인할 수 있었다.


### Extract(추출)
1. 운영중인 OLTP 데이터베이스에서 필요한 데이터를 가져온다.
2. 운영 시스템의 부하를 최소화 하기 위해 서비스 이용시간이 적은 시간대에 배치 작업을 실행하거나 데이터 변경이력(Log)를 읽어온다.

### Transform(변환)
1. 추출한 데이터를 분석에 적합한 형태로 가공 및 모델링한다.
2. 불필요하거나 잘못된, 중복된 데이터를 제거한다.
3. 여러 소스에서 가져온 데이터를 통합한다.
4. OLTP의 정규화 된 데이터를 OLAP에 적합하게 집계한다.

### Load(적재)
1. 변환 과정이 끝난 데이터를 최종 목적지인 OLAP 시슽메에 저장한다.

적재가 완료되면 분석가 혹은 BI툴이 이 데이터를 원하는 형태로 조회하고 시각화한다.

